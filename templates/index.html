<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustainable Traffic Analysis using CNN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand" href="#">ðŸš¦ Sustainable Traffic Analysis</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#upload">Upload Image</a></li>
                    <li class="nav-item"><a class="nav-link" href="#results">Results</a></li>
                    <li class="nav-item"><a class="nav-link" href="#insights">Sustainability Insights</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <!-- Home Section -->
        <section id="home" class="mb-5">
            <h1 class="text-center text-success">Welcome to Green Traffic AI ðŸŒ±</h1>
            <p class="text-center">Upload a traffic camera image to classify congestion levels (Low, Medium, High) and get AI-driven sustainability tips to reduce emissions.</p>
            <div class="text-center">
                <img src="{{ url_for('static', filename='background.jpg') }}" class="img-fluid rounded" alt="Traffic Image" style="max-width: 50%;">
            </div>
        </section>

        <!-- Upload Section -->
        <section id="upload" class="mb-5">
            <h2 class="text-success">Upload Traffic Image</h2>
            <form method="POST" enctype="multipart/form-data" class="border p-4 rounded bg-white">
                <div class="mb-3">
                    <label for="file" class="form-label">Choose a .jpg or .png image:</label>
                    <input type="file" class="form-control" id="file" name="file" accept=".jpg,.png,.jpeg" required>
                </div>
                <button type="submit" class="btn btn-success">Analyze Traffic</button>
            </form>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="alert alert-info mt-3">{{ messages[0] }}</div>
                {% endif %}
            {% endwith %}
        </section>

        <!-- Results Section -->
        <section id="results" class="mb-5">
            <h2 class="text-success">Prediction Results</h2>
            {% if prediction %}
                <div class="alert alert-{{ colors[prediction] }} text-center">
                    <h4>Predicted Traffic: {{ prediction.upper() }} {{ icons[prediction] }}</h4>
                    <p>Confidence: {{ confidence }}%</p>
                    {% if image_path %}
                        <img src="{{ url_for('static', filename='uploads/' + image_path.split('/')[-1]) }}" class="img-fluid mt-3" alt="Uploaded Image" style="max-width: 300px;">
                    {% endif %}
                    <p class="mt-3">{{ sustain_msg }}</p>
                </div>
                <h5>Model Performance Visuals</h5>
                <div class="row">
                    <div class="col-md-6">
                        <img src="{{ url_for('static', filename='graphs/accuracy_loss.png') }}" class="img-fluid" alt="Accuracy & Loss">
                    </div>
                    <div class="col-md-6">
                        <img src="{{ url_for('static', filename='graphs/confusion_matrix.png') }}" class="img-fluid" alt="Confusion Matrix">
                    </div>
                </div>
            {% else %}
                <p class="text-muted">Upload an image to see results.</p>
            {% endif %}
        </section>

        <!-- Sustainability Insights Section -->
        <section id="insights" class="mb-5">
            <h2 class="text-success">ðŸŒ± Sustainability Impact</h2>
            <p>AI supports eco-friendly traffic by analyzing congestion and suggesting optimizations. Studies show AI can reduce COâ‚‚ emissions by 10-20% in urban areas through better flow management.</p>
            <p><strong>How it works:</strong> Our CNN model detects traffic levels from images, enabling real-time adjustments like signal timing or route suggestions.</p>
            {% if co2_msg %}
                <div class="alert alert-success">
                    <strong>Personalized Impact:</strong> {{ co2_msg }}
                </div>
            {% endif %}
            <h5>Example COâ‚‚ Savings Chart</h5>
            <canvas id="co2Chart" width="400" height="200"></canvas>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                const ctx = document.getElementById('co2Chart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Low', 'Medium', 'High'],
                        datasets: [{
                            label: 'COâ‚‚ Saved (kg/month per intersection)',
                            data: [50, 80, 120],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                        }]
                    }
                });
            </script>
        </section>
    </div>

    <footer class="bg-success text-white text-center py-3 mt-5">
        <p>&copy; 2023 Sustainable Traffic Analysis. Built for Green Skills Internship using TensorFlow & Flask.</p>
        <p><strong>About Project:</strong> CNN model accuracy: ~85%. Powered by AI for reduced emissions.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>